# TCP 拥塞控制



## 基本概念。

简单来说，开始出现丢包现象。

----

理想和实际情况下，网络吞吐量和负载的关系



![网络情况](/img/network_tcp_01.png)





## 拥塞控制算法

有四种算法： **慢开始、拥塞避免、快重传、快恢复**



### 慢开始和拥塞避免

在 `TCP` 双方建立逻辑连接关系时拥塞窗口(`cwnd`)的值被设置为 1, 慢开始门限(`ssthresh`)的初始值采用 16。

- 阶段一：慢开始，发送方每收到一个确认时，就把拥塞窗口值以`指数规律`扩增。

- 阶段二：拥塞避免，进入条件: `cwnd == ssthresh` 时，拥塞窗口值以`线性规律`增长，每次增长 1。

![慢开始和拥塞避免](/img/network_tcp_02.png)

假设当 `cwnd = 24` 出现丢包，发送方任务网络出现拥塞，会做一下操作：

1. `ssthresh` 减少到当前 `cwnd` 的一半;
2. `cwnd ` 设置为 `1`, 重新开始阶段一;

&gt; 慢开始是指一开始向网络注入的报文段少而并不是指拥塞窗口值增长速度慢。拥塞避免也并非指完全能够避免拥塞，而是指在拥塞避免阶段，将拥塞窗口值控制为按线性规律增长，使网络比较不容易出现拥塞。

### 快重传

&gt; 有时个别报文段会在网络中丢失，但实际上网络并未发生拥塞，发送方误认为网络发生了拥塞，从而降低了传输效率。采用快重传算法，就是让发送方尽早知道当前只是发生了个别报文段的丢失。

快重传：就是使发送方**尽快进行重传**，而**不是等超时重传计时器超时**再重传，可以使整个网络的吞吐量提高约20%

- 要求接收方不要等待自己发送数据时才进行稍待确认，而是要**立即发送确认**。
- 即使收到了失去的报文段，也要立即发送对已收到的报文段的**重复确认**。
- 发送方一旦**收到 3 个连续的重复确认**，就将相应的报文段**立即重传**，而不是等该报文段的重传计时器超时再重传。

![快重传](/img/network_tcp_04.png)


### 快恢复

发送方一旦收到 3 个重复，确认就知道现在只是丢失了个别的报文段，于是不启动慢开始算法，而是执行快恢复算法： 
1. `ssthresh` 和 `cwnd` 减少到当前 `cwnd` 的一半; (也存在把 `cwnd` 在增加 `3`, 理由是发送方发送了 3 个确认包，表示接收了三个数据包)
2. 执行拥塞避免算法，将拥塞窗口值按线性规律增长。

![快恢复](/img/network_tcp_03.png)



---

> 作者: 迷途小狼崽  
> URL: https://cronusqiu90.github.io/posts/network/tcp%E6%8B%A5%E5%A1%9E%E7%AE%97%E6%B3%95/  

